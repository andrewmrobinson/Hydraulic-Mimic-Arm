clear all
close all
clc
%2018 FYP - Hydraulic Hand
%Andrew Robinson
%Makes box and whisker plots displaying error

max_angles = [1.239183769 1.417207353;...
    1.499237827 1.523672437;...
    1.249655744 1.425933999;...
    1.291543646 1.438151304];
formula_coeff = [-860.17 2137.9 -763.63 2768.9;...
    -753.43 2173.6 -750.32 2845.0;...
    -703.44 2065.4 -752.06 2707.1;...
    -705.92 2182.4 -790.62 2852.7];
lower_coeff = [-753.25 2051.8;...
    -754.84 2252.7;...
    -742.33 2064.5;...
    -843.35 2220.7];

specifics = [1,1;...
    2,1;...
    3,1;...
    8,1;...
    8,4;...
    7,1;...
    9,1];
time_limits = [7,14];
  
titles = {'Single Finger Step Response PID={0.4, 0.01, 0.02}'...
    'Single Finger Step Response PID={0.4, 0.1, 0.2}'...
    'Single Finger Ramp Response PID={0.4, 0.1, 0.02}'...
    'Leap Motion Sensor Follow (Cyl 0)'...
    'Leap Motion Sensor Follow (Cyl 3)'...
    'Ramp Response (all cylinders running)'...
    'Leap Motion Sensor Follow (Cyl 0)'};


filenames = {'hand follow COM5_2018-10-08 170356.csv'...
    'hand follow COM3_2018-10-08 170356.csv'};
cyl_error = [];
for j = 1:length(filenames)
    [data, ~, raw_data] = xlsread(filenames{j});
    %data = data(600:end,:);
    time_step = 8 /1000; %8 ms
    t = [1:size(data,1)]'*time_step;
    data = data(t>=time_limits(1)&t<=time_limits(2),:);
    t = t(t>=time_limits(1)&t<=time_limits(2),:);
    no_cyl = 4;
    for i = 1:no_cyl
        %error(:,i) = abs(data(:,i+4)-data(:,i)); %desired-actual
        error = [];
        error = abs(data(:,i+4)-data(:,i)); %desired-actual
        error(data(:,i+4)==0) = NaN;
        
        
        if i+(j-1)*4 <5
            error = abs(rad2deg(error./lower_coeff(i,1)));
        else
            error = abs(rad2deg(error./mean([formula_coeff(i,1),formula_coeff(i,3)])));
        end
        
        cyl_error(:,i+(j-1)*4) = error;

        %print(gcf,[num2str(k) ' - refined - ' filenames{j} ' - Error of Cyl ' num2str(i-1) '.png'],'-dpng');
    end
end
label_names = {'L C0' 'L C1' 'L C2' 'L C3' 'U C0' 'U C1' 'U C2' 'U C3'};
boxplot(cyl_error,'whisker',3,'labels',label_names)
xlabel('Cylinder L - Lower Proximal Phalanx, U  - Upper Middle and Distal Phalanx');
ylabel('Error (degrees)');
title('Error in all cylinders of the hand follow the leap motion controller');
